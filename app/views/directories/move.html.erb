<%= form_with(model: @directory, url: directory_path(@directory), method: :patch) do |form| %>
  <div class="field">
    <%= form.label :parent %>
    <%= form.select :parent_id, (@directory.parent ? [['Top Level', nil]] : []) + Directory.all_except(@current_parent ? [@directory, @current_parent] : @directory).collect {|d| [d.full_path, d.id]} %>
  </div>

  <div class="actions">
    <%= form.submit %>
  </div>
<% end %>